<div class="wrapper border-bottom p-1">
    <span class="badge badge-primary">
        <div class="icon-wrapper">
            <value-icon *ngIf="sg.type === 'Value'" class="sg-icon"></value-icon>
            <range-icon *ngIf="sg.type === 'Range'" class="sg-icon"></range-icon>
            <comparative-icon *ngIf="sg.type === 'Comparative'" class="sg-icon"></comparative-icon>
            <rank-icon *ngIf="sg.type === 'Rank'" class="sg-icon"></rank-icon>
            <powerlaw-icon *ngIf="sg.type === 'PowerLaw'" class="sg-icon"></powerlaw-icon>
            <normal-icon *ngIf="sg.type === 'Normal'" class="sg-icon"></normal-icon>
            <linear-icon *ngIf="sg.type === 'Linear'" class="sg-icon"></linear-icon>
        </div>
        {{ L[sg.type] }}
    </span>
    <span class="badge badge-secondary ml-1">{{ sg.query.recentProgress.processedPercent() | percent}}</span>
    <span class="badge badge-warning ml-1"><fa-icon [icon]="['far', 'bell']"></fa-icon></span>
    <span class="badge badge-danger ml-1"><fa-icon [icon]="['fas', 'exclamation-triangle']"></fa-icon></span>

    <div class="display my-1">
        <sg-display [safeguard]="sg"></sg-display>
    </div>

    <div class="d-flex">
        <p-indicator *ngIf="sg.isP()" [p]="sg.p()" class="flex-grow-1"></p-indicator>

        <boolean-indicator *ngIf="sg.isBoolean()" [t]="sg.t()" class="flex-grow-1"></boolean-indicator>

        <quality-indicator *ngIf="sg.isQuality()" [q]="sg.q()" class="flex-grow-1"></quality-indicator>

        <error-indicator *ngIf="sg.isError()" [e]="sg.e()" class="flex-grow-1"></error-indicator>

        <button type="button" class="btn btn-sm btn-secondary ml-1" (click)="toggleConfigPanel()"
            [class.open]="configPanelOpen">
            <fa-icon [icon]="['fas', 'cog']"></fa-icon>
        </button>
    </div>
    <!-- <div class="p-1 config-border rounded" *ngIf="configPanelOpen && !notiPanelOpen">
        <button type="button" class="btn btn-sm btn-warning mr-1" (click)="openNotiPanel()">
            <fa-icon [icon]="['far', 'bell']"></fa-icon>
            Manage notifications
        </button>
        <button type="button" class="btn btn-sm btn-danger" (click)="removeClicked.emit(sg)">
            <fa-icon [icon]="['fas', 'times']"></fa-icon>
            Remove
        </button>
    </div> -->
    <div class="p-1 config-border rounded" *ngIf="configPanelOpen">        
        <h5 class="m-1">Rules</h5>
        <hr class="config-border my-1 sep">
        <p>
            No notification rules are added. Add one by clicking on the "New Rule" button below.
        </p>
        <button class="btn btn-sm btn-primary w-100" (click)="openRulePanel()">New Rule</button>
        <button type="button" class="btn btn-sm btn-danger w-100 mt-1" (click)="removeClicked.emit(sg)">
            Remove this PVA-Guard
        </button>
    </div>
    <div class="p-1 config-border rounded" *ngIf="rulePanelOpen">
        <h5 class="m-1">Adding a New Rule</h5>
        <hr class="config-border my-1 sep">
        <div class="form-check">
            <input class="form-check-input font-control-lg" type="checkbox" [id]="id+1">
            <label class="form-check-label" [for]="id+1">
                The progress reaches to a point.
            </label>
            <div class="d-flex flex-row align-items-center" *ngIf="demo1">
                <input type="range" min="1" max="100" value="50" [id]="id+1" class="mr-2 w-100">
                <input type="number" class="form-control form-control-sm text-right" min="1" max="100" value="50" style="width:40px">
                <span class="ml-1">%</span>
            </div>            
        </div>
        <div class="form-check">
            <input class="form-check-input font-control-lg" type="checkbox" [id]="id+1">
            <label class="form-check-label" [for]="id+1">
                A certain number of rows are processed.
            </label>
            <div class="d-flex flex-row align-items-center" *ngIf="demo1">
                <input type="range" min="1" max="100" value="50" [id]="id+1" class="mr-2 w-100">
                <input type="number" class="form-control form-control-sm text-right" min="1" max="10000" value="5000" step="100" style="width:100px">
                <span class="ml-1">rows</span>
            </div>            
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" [id]="id+2">
            <label class="form-check-label" [for]="id+2">
                After a certain period of time
            </label>
            <div class="d-flex flex-row align-items-center" *ngIf="demo1">
                <input type="number" class="form-control form-control-sm  text-right" min="1" max="300" value="30" style="width:50px">
                <select class="form-control form-control-sm ml-1" style="width:100px">
                    <option selected>minutes</option>
                    <option>hours</option>
                </select>
            </div>
        </div>

        <div class="text-center condition-and my-2">- AND -</div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" [id]="id+2">
            <label class="form-check-label" [for]="id+2">
                <em>{{ sg.validityName() }}</em> becomes larger than a threshold.
            </label>
            <div class="d-flex flex-row align-items-center" *ngIf="demo1">
                <em>{{ sg.validityName() }}</em>
                <span class="ml-1">{{ sg.isP() || sg.isError() ? '>' : '<'}}</span>
                <input type="number" class="form-control form-control-sm ml-1" min="0" value="0.05">
            </div>
        </div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" [id]="id+2">
            <label class="form-check-label" [for]="id+2">
                <em>Error</em> increases by a specific amount.
            </label>
            <div class="d-flex flex-row align-items-center" *ngIf="demo1">
                <input type="number" class="form-control form-control-sm text-right" min="1" max="100" value="30" style="width:40px">
                <span class="ml-1">%</span>
            </div>            
        </div>

        <div class="text-right mt-1">
            <button class="btn btn-sm btn-success mr-1">Add a Rule</button>
            <button class="btn btn-sm btn-danger" (click)="openConfigPanel()">Cancel</button>
        </div>
    </div>

    <div class="p-1 config-border rounded mt-1">
        <h6 class="m-1">Recent Activity</h6>
        <p><em>p</em> has reached to a target (0.05).</p>
        <hr class="notification-border my-1 sep">

        <button class="btn btn-sm btn-outline-secondary mb-1" style="width:100%">Notify me if it happens again.</button>
        <button class="btn btn-sm btn-outline-secondary mb-1" style="width:100%">Remove the notification.</button>
        <button class="btn btn-sm btn-outline-secondary mb-1" style="width:100%">Set the constant to the current value.</button>
        <button class="btn btn-sm btn-outline-secondary mb-1" style="width:100%">Manually set the constant.</button>
        <button class="btn btn-sm btn-outline-secondary mb-1" style="width:100%">Set a new <em>p</em> value for the alert.</button>
        <button class="btn btn-sm btn-outline-danger" style="width:100%">Remove this PVA-Guard.</button>
    </div>
    <!--<fa-icon [icon]="['far', 'clock']"></fa-icon>
    <p class="m-0">Updated {{ sg.lastUpdatedAt | amTimeAgo }}</p>
    <p class="m-0">Created {{ sg.createdAt | amTimeAgo }}</p> -->
</div>
