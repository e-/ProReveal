<div *ngIf="node && node.query">
<header class="query-desc mt-2 ml-2">
    <!-- <strong>Q{{ node.query.id }}: </strong> -->

<span *ngIf="node.query.target === null">COUNT(<small><fa-icon [icon]="['fas', 'asterisk']"></fa-icon></small>)</span>
<span *ngIf="node.query.target !== null">
    <form class="form-inline aggregate-form">
    <select class="form-control form-control-md">
        <option *ngFor="let accumulator of accumulators">
            {{ accumulator }}
        </option>
    </select>
    </form>
    (<field-badge [field]="node.query.target" class="mr-1"></field-badge>{{ node.query.target.name }})

    </span><span class="keyword ml-1">GROUPED BY</span>
    <ng-container *ngFor="let field of node.query.groupBy.fields; index as i">
        <field-badge [field]="field" class="ml-2 mr-1"></field-badge>{{ field.name }}<span *ngIf="node.query.groupBy.fields.length > 1 && i < node.query.groupBy.fields.length - 1" class="keyword">,</span>
    </ng-container>
</header>

<hr>

<p [hidden]="node.query.progress.processedBlocks > 0" class="alert alert-primary" role="alert">
    This query has not been start yet. Reorder <strong>the ongoing list</strong> to give a high priority to this query.
</p>

<div [hidden]="node.query.progress.processedBlocks === 0" class="vis-content">
    <div class="progress-control">
        <div class="progress mb-1">
            <div class="progress-bar" role="progressbar"
                [style.width.%]="node.query.progress.processedPercent() * 100"
                [attr.aria-valuenow]="node.query.progress.processedPercent() * 100"
                aria-valuemin="0" aria-valuemax="100">
            </div>
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                [style.width.%]="node.query.progress.ongoingPercent() * 100"
                [attr.aria-valuenow]="node.query.progress.ongoingPercent() * 100"
                aria-valuemin="0" aria-valuemax="100">
            </div>
        </div>
        <div class="d-flex flex-row justify-content-between mb-1">
            <div class="p-2 flex-grow-1">
                {{ node.query.progress.processedBlocks }} / {{ node.query.progress.totalBlocks}}
                ({{ node.query.progress.processedPercent() | percent }})
            </div>
            <button type="button" class="btn btn-light btn-sm ml-1"
                (click)="node.query.updateAutomatically=!node.query.updateAutomatically">
                <fa-icon icon="check-square" [hidden]="!node.query.updateAutomatically"></fa-icon>
                <fa-icon [icon]="['far', 'square']" [hidden]="node.query.updateAutomatically"></fa-icon>
                Update automatically
            </button>

            <button type="button" class="btn btn-light btn-sm ml-1" [disabled]="node.query.updateAutomatically">
                <fa-icon icon="sync-alt"></fa-icon>
                Sync
            </button>
        </div>
    </div>

    <svg class="mt-2" #svg></svg>

    <tooltip #tooltip></tooltip>

    <!-- <div>
        Sort a categorical axis
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary">Data</button>
            <button type="button" class="btn btn-outline-secondary">Alaphabetical</button>
            <button type="button" class="btn btn-outline-secondary">Value</button>
        </div>
    </div>

    <div>
        Sort a numerical axis (binning)
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary">Default</button>
            <button type="button" class="btn btn-outline-secondary">Value</button>
        </div>
    </div> -->
</div>
</div>
