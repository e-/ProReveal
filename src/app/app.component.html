<div id="wrapper" (click)="wrapperClicked()">
    <section class="navbar navbar-dark bg-dark box-shadow d-flex justify-content-start" id="navbar">
        <button (click)="toggleMetadataEditor()" class="btn btn-dark" id="open-metadata-editor">
            <fa-icon icon="folder-open"></fa-icon>
        </button>
        <a href="#" class="navbar-brand">TouchExplorer
            <small> (movies.json)</small>
        </a>
    </section>
    <section id="query-view">
        <ng-container *ngFor="let node of nodes">
            <div class="query"
                (click)="nodeSelected(node)" [class.selected]="activeNode === node">
                <progress-ring [processed]="node.query.progress.processedPercent()"
                    [ongoing]="node.query.progress.ongoingPercent()"></progress-ring>
                <ul class="field-names">
                    <li *ngFor="let field of node.fields">
                        <field-badge [field]="field"></field-badge>
                        {{ field.name }}
                    </li>
                </ul>
            </div>
            <div class="actions" *ngIf="activeNode === node">
                <button class="btn btn-light"><fa-icon [icon]="['fas', 'play']"></fa-icon></button>
                <button class="btn btn-light"><fa-icon [icon]="['fas', 'trash']"></fa-icon></button>
                <button class="btn btn-light"
                    (click)="plusClicked($event, node)"
                ><fa-icon style="pointer-events: none" [icon]="['fas', 'plus']"></fa-icon></button>
            </div>
        </ng-container>
        <!-- <div *ngFor="let query of engine.queries" class="query">
            <strong>Q{{ query.id }}</strong>:
            {{ query.desc() }}
            <field-badge [field]="query.groupBy.fields[0]"></field-badge>
            {{ query.groupBy.fields[0].name }}
            <div class="progress">
                <div class="progress-bar" role="progressbar"
                    [style.width.%]="query.progress.processedPercent() * 100"
                    [attr.aria-valuenow]="query.progress.processedPercent() * 100"
                    aria-valuemin="0" aria-valuemax="100">
                </div>
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                    [style.width.%]="query.progress.ongoingPercent() * 100"
                    [attr.aria-valuenow]="query.progress.ongoingPercent() * 100"
                    aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div> -->
    </section>
    <!-- <section id="exploration-view-wrapper">
        <exploration-view #explorationView [root]="explorationRoot" [dataset]="dataset"
            (nodeSelected)="nodeSelected($event.node, $event.nodeView, $event.left, $event.top, $event.child)"
            (nodeUnselected)="nodeUnselected($event.node, $event.nodeView, $event.child)">
        </exploration-view>
        <button (click)="toggleEditable()" class="btn btn-primary" id="toggle-editable">
            <fa-icon icon="edit"></fa-icon>
        </button>
    </section> -->
    <section id="main">
        <button class="btn btn-primary" (click)="run(1)">Run a job</button>
        &nbsp;
        <button class="btn btn-primary" (click)="run(10)">Run 10 jobs</button>
        &nbsp;
        <button class="btn btn-primary" (click)="run(100)">Run 100 jobs</button>
        <div *ngIf="!activeNode">
            <p>
                Choose a node to inspect.
            </p>
        </div>
        <div *ngIf="activeNode">
            <h2>Query {{ activeNode.query.id }}</h2>
            <vis [node]="activeNode"></vis>
            <p>
                Description: {{ activeNode.query.desc() }}
                <br /> Progress: {{ activeNode.query.progress.processed }} / {{ activeNode.query.progress.total }}
            </p>
        </div>
    </section>

    <metadata-editor [dataset]="dataset" #metadataEditor id="metadata-editor" [hidden]="!metadataEditor.visible">
    </metadata-editor>

    <!-- <section style="padding:5px; grid-row:2; grid-column:2;">

    </section>
    <queue-view [queue]="engine.queue" *ngIf="engine"></queue-view> -->
</div>

<field-selector #fieldSelector (fieldSelected)="fieldSelected($event.node, $event.field)"></field-selector>
