<div id="wrapper" (click)="wrapperClicked()">
    <section class="navbar navbar-dark bg-dark box-shadow d-flex justify-content-start" id="navbar">
        <button (click)="toggleMetadataEditor()" class="btn btn-dark" id="open-metadata-editor">
            <fa-icon icon="folder-open"></fa-icon>
        </button>
        <a href="#" class="navbar-brand">TouchExplorer
            <small> (movies.json)</small>
        </a>
        <button class="btn btn-primary" (click)="run(1)">Run a job</button>
        &nbsp;
        <button class="btn btn-primary" (click)="run(10)">Run 10 jobs</button>
        &nbsp;
        <button class="btn btn-primary" (click)="run(100)">Run 100 jobs</button>
    </section>
    <section id="node-view">
        <h6 id="completed-node-view-header">Completed Queries</h6>
        <section id="completed-node-view" class="styled-scroll">
            <div *ngFor="let node of completedNodes" [class.highlighted]="highlightedNodes.includes(node)"
                (mouseenter)="hoveredNode = node"
                (mouseleave)="hoveredNode = null"
            >
                <div class="query" (click)="nodeSelected(node)" [class.selected]="activeNode === node">
                    <progress-ring [processed]="node.query.progress.processedPercent()" [ongoing]="node.query.progress.ongoingPercent()"></progress-ring>
                    <ul class="field-names">
                        <li *ngFor="let field of node.fields">
                            <field-badge [field]="field"></field-badge>
                            {{ field.name }}
                        </li>
                    </ul>
                </div>
                <div class="actions" *ngIf="activeNode === node">
                    <button class="btn btn-light">
                        <fa-icon [icon]="['fas', 'trash']"></fa-icon>
                    </button>
                    <button class="btn btn-light" (click)="plusClicked($event, node)">
                        <fa-icon style="pointer-events: none" [icon]="['fas', 'plus']"></fa-icon>
                    </button>
                </div>
            </div>
        </section>
        <h6 id="ongoing-node-view-header">Ongoing Queries</h6>
        <section id="ongoing-node-view" class="styled-scroll" [sortablejs]="ongoingNodes" [sortablejsOptions]="sortablejsOptions">
            <div *ngFor="let node of ongoingNodes"
                [class.highlighted]="highlightedNodes.includes(node)"
                (mouseenter)="hoveredNode = node"
                (mouseleave)="hoveredNode = null"
            >
                <div class="query" (click)="nodeSelected(node)" [class.selected]="activeNode === node">
                    <progress-ring [processed]="node.query.progress.processedPercent()" [ongoing]="node.query.progress.ongoingPercent()"></progress-ring>
                    <ul class="field-names">
                        <li *ngFor="let field of node.fields">
                            <field-badge [field]="field"></field-badge>
                            {{ field.name }}
                        </li>
                    </ul>
                    <fa-icon class="state-icon" [icon]="['fas', 'play']" [hidden]="node.state === NodeState.Paused"></fa-icon>
                    <fa-icon class="state-icon" [icon]="['fas', 'pause']" [hidden]="node.state === NodeState.Running"></fa-icon>
                </div>
                <div class="actions" *ngIf="activeNode === node">
                    <button class="btn btn-light" [hidden]="activeNode.state === NodeState.Paused" (click)="activeNode.pause()">
                        <fa-icon [icon]="['fas', 'play']"></fa-icon>
                    </button>
                    <button class="btn btn-light" [hidden]="activeNode.state === NodeState.Running" (click)="activeNode.run()">
                        <fa-icon [icon]="['fas', 'pause']"></fa-icon>
                    </button>
                    <button class="btn btn-light" (click)="deleteClicked(confirmDelete, node)">
                        <fa-icon [icon]="['fas', 'trash']"></fa-icon>
                    </button>
                    <button class="btn btn-light" (click)="plusClicked($event, node)">
                        <fa-icon style="pointer-events: none" [icon]="['fas', 'plus']"></fa-icon>
                    </button>
                </div>
            </div>
        </section>
        <section id="search">
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">
                        <fa-icon [icon]="['fas', 'search']"></fa-icon>
                    </span>
                </div>
                <input type="text" class="form-control" placeholder="Search" (input)="keywordSearched($event.target.value)" [ngModel]="searchKeyword">
                <div class="input-group-append">
                    <button class="btn btn-light" type="button" (click)="searchKeyword='';highlightedNodes=[]">
                        <fa-icon [icon]="['fas', 'times']"></fa-icon>
                    </button>
                    <button class="btn btn-light" type="button" (click)="voiceSearchClicked()">
                        <fa-icon [icon]="['fas', 'microphone']"></fa-icon>
                    </button>
                </div>
            </div>
        </section>
        <section id="graph" class="styled-scroll">
            <exploration-view #explorationView
                [root]="explorationRoot"
                [hoveredNode]="hoveredNode"
                [activeNode]="activeNode"
                >
            </exploration-view>
        </section>
    </section>
    <!-- <section id="exploration-view-wrapper">
        <exploration-view #explorationView [root]="explorationRoot" [dataset]="dataset"
            (nodeSelected)="nodeSelected($event.node, $event.nodeView, $event.left, $event.top, $event.child)"
            (nodeUnselected)="nodeUnselected($event.node, $event.nodeView, $event.child)">
        </exploration-view>
        <button (click)="toggleEditable()" class="btn btn-primary" id="toggle-editable">
            <fa-icon icon="edit"></fa-icon>
        </button>
    </section> -->
    <section id="main" class="styled-scroll">
        <div *ngIf="!activeNode">
            <p>
                Choose a node to inspect.
            </p>
        </div>
        <div *ngIf="activeNode">
            <sketchbook></sketchbook>
            <vis [node]="activeNode"></vis>
        </div>
    </section>

    <metadata-editor [dataset]="dataset" #metadataEditor id="metadata-editor" [hidden]="!metadataEditor.visible">
    </metadata-editor>

    <!-- <section style="padding:5px; grid-row:2; grid-column:2;">

    </section>
    <queue-view [queue]="engine.queue" *ngIf="engine"></queue-view> -->
</div>

<field-selector #fieldSelector (fieldSelected)="fieldSelected($event.node, $event.field)"></field-selector>

<ng-template #confirmDelete let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm Deletion</h4>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p>
            Are you sure?
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger"
        (click)="c()">Delete</button>
        <button type="button" class="btn btn-outline-secondary"
        (click)="d()">Cancel</button>
    </div>
</ng-template>
